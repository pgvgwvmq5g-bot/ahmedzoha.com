---
// Sidebar.astro - Main navigation sidebar component
const currentPath = Astro.url.pathname;

const navItems = [
  { name: 'Homepage', href: '/', icon: 'home' },
  { name: 'About', href: '/about', icon: 'user' },
  { name: 'Research', href: '/research', icon: 'search' },
  { name: 'Impact', href: '/impact', icon: 'infinity' },
  { name: 'Projects', href: '/projects', icon: 'layers' },
  { name: 'FLAIR', href: '/modai', icon: 'cpu' },
  { name: 'News & Updates', href: '/news', icon: 'newspaper' },
  { name: 'Blog / Insights', href: '/blog', icon: 'pen' },
  { name: 'Contact', href: '/contact', icon: 'mail' },
];

const socialLinks = [
  { name: 'Google Scholar', href: 'https://scholar.google.com/citations?user=b0oVLKwAAAAJ&hl=en', icon: 'graduation-cap' },
  { name: 'X (Twitter)', href: 'https://x.com/AhmedZoha', icon: 'twitter' },
  { name: 'LinkedIn', href: 'https://www.linkedin.com/in/ahmedzoha', icon: 'linkedin' },
];

// Helper to check if link is active
const isActive = (href: string) => {
  if (href === '/') return currentPath === '/';
  return currentPath.startsWith(href);
};
---

<aside id="sidebar" class="fixed left-0 top-0 h-screen w-64 bg-dark-800 border-r border-dark-500/30 flex flex-col z-50 transform -translate-x-full lg:translate-x-0 transition-all duration-300">

  <!-- Profile Section -->
  <div class="p-6 border-b border-dark-500/30">
    <div class="flex items-center gap-3">
      <div class="w-12 h-12 rounded-full bg-dark-600 overflow-hidden relative" id="profile-img-container">
        <img 
          id="profile-img"
          src="/images/profile.jpg" 
          alt="Ahmed Zoha" 
          class="w-full h-full object-cover"
        />
        <div id="profile-fallback" class="w-full h-full flex items-center justify-center text-accent-yellow text-lg font-semibold hidden absolute inset-0 bg-dark-600">
          AZ
        </div>
      </div>
      <div>
        <h2 class="font-semibold text-text-primary">Dr Ahmed Zoha</h2>
        <p class="text-[10px] text-text-muted leading-relaxed">
          Professor of Distributed AI |<br/>
          Research Director | Driving AI for Social Good
        </p>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 overflow-y-auto py-4 px-3">
    <ul class="space-y-1">
      {navItems.map((item) => (
        <li>
          <a 
            href={item.href} 
            class={`nav-link ${isActive(item.href) ? 'active' : ''}`}
          >
            <span class="w-5 h-5 flex items-center justify-center">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                {item.icon === 'home' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />}
                {item.icon === 'user' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />}
                {item.icon === 'search' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />}
                {item.icon === 'infinity' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.739-8-4.781 0-4.781 8 0 8 5.606 0 7.644-8 12.74-8z" />}
                {item.icon === 'layers' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />}
                {item.icon === 'cpu' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 3v2m6-2v2M9 19v2m6-2v2M3 9h2m-2 6h2m14-6h2m-2 6h2M7 7h10v10H7V7z" />}
                {item.icon === 'newspaper' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />}
                {item.icon === 'pen' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />}
                {item.icon === 'mail' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />}
              </svg>
            </span>
            <span class="text-sm">{item.name}</span>
          </a>
        </li>
      ))}
    </ul>

    <!-- Social Section -->
    <div class="mt-8 pt-6 border-t border-dark-500/30">
      <p class="px-4 text-xs text-text-muted uppercase tracking-wider mb-3">Social</p>
      <ul class="space-y-1">
        {socialLinks.map((link) => (
          <li>
            <a 
              href={link.href} 
              target="_blank"
              rel="noopener noreferrer"
              class="nav-link"
            >
              <span class="w-5 h-5 flex items-center justify-center">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  {link.icon === 'graduation-cap' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 14l9-5-9-5-9 5 9 5z M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />}
                  {link.icon === 'twitter' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z" />}
                  {link.icon === 'linkedin' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z M2 4a2 2 0 114 0 2 2 0 01-4 0z" />}
                  {link.icon === 'github' && <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22" />}
                </svg>
              </span>
              <span class="text-sm">{link.name}</span>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </nav>

  <!-- Bottom Actions -->
  <div class="p-4 border-t border-dark-500/30 flex items-center gap-4">
    <button id="search-toggle" class="p-2 rounded-lg hover:bg-dark-600 transition-colors" title="Search">
      <svg class="w-5 h-5 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    </button>
  </div>
</aside>

<!-- Mobile Menu Button -->
<button
  id="mobile-menu-btn"
  class="fixed top-4 left-4 z-50 p-2 bg-dark-700 rounded-lg lg:hidden"
>
  <svg class="w-6 h-6 text-text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
  </svg>
</button>

<!-- Mobile Overlay -->
<div id="mobile-overlay" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden"></div>

<script>
  // Mobile menu toggle
  const sidebar = document.getElementById('sidebar');
  const mobileBtn = document.getElementById('mobile-menu-btn');
  const overlay = document.getElementById('mobile-overlay');

  mobileBtn?.addEventListener('click', () => {
    sidebar?.classList.toggle('-translate-x-full');
    overlay?.classList.toggle('hidden');
  });

  overlay?.addEventListener('click', () => {
    sidebar?.classList.add('-translate-x-full');
    overlay?.classList.add('hidden');
  });

  // Safe image error fallback handler
  const profileImg = document.getElementById('profile-img');
  const profileFallback = document.getElementById('profile-fallback');
  
  if (profileImg && profileFallback) {
    profileImg.addEventListener('error', () => {
      profileImg.style.display = 'none';
      profileFallback.classList.remove('hidden');
    });
  }
</script>
